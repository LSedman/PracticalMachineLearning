---
title: "Practical Machine Learning Course Project"
author: "Laura Sedman"
date: "09/13/2014"
output: html_document
---



```{r getData}
url1 <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
url2 <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"

if (!file.exists("pml-training.csv")) {
        download.file(url1, destfile="pml-training.csv", method="curl")
}

if (!file.exists("pml-testing.csv")) {
        download.file(url2, destfile="pml-testing.csv", method="curl")
}

data <- read.csv("pml-training.csv")
finalTesting <- read.csv("pml-testing.csv")
```


```{r splitData}

library(caret)

set.seed(27)
inTrain <- createDataPartition(y = data$classe, p=0.7, list=FALSE)
train <- data[inTrain,]
test <- data[-inTrain,]
rm(inTrain)
rm(data)
```

``` {r exploreData and preprocess}
str(train)
NAs <- colSums(is.na(train))
NAs <- names(subset(NAs, NAs != 0))
train <- train[ , !names(train) %in% NAs] 
test <- test[ , !names(test) %in% NAs] 
finalTesting <- finalTesting[ , !names(finalTesting) %in% NAs] 
rm(NAs)

train <- train[, -c(1, 3:5)]
noVar <- nearZeroVar(train)
train <- train[, -noVar]

test <- test[, -c(1, 3:5)]
test <- test[, -noVar]

finalTesting <- finalTesting[, -c(1, 3:5)]
finalTesting <- finalTesting[, -noVar]

rm(noVar)
```

``` {r LDA}
#trainSample <- train[sample(1:nrow(train), 500, replace=FALSE),]
preObj <- preProcess(train[,c(-1, -55)], method="BoxCox")
trainBoxCox <- predict(preObj, train[,c(-1, -55)])
trainBoxCox <- cbind(train$user_name, trainBoxCox, train$classe)
names(trainBoxCox) <- names(train)

modelFitLDA <- train(classe ~ ., data=trainBoxCox, method="lda",
                  trControl = trainControl(method="cv", number=10))
modelFitLDA
``` 

``` {r tree}
modelFitTree <- train(classe ~ ., data=train, method="rpart", 
                  trControl = trainControl(method="cv", number=10))
modelFitTree

modelFitRf <- train(classe ~ ., data=train, method="rf", 
                  trControl = trainControl(method="cv", number=10))
modelFitRf # use this one

modelFitRf2 <- train(classe ~ ., data=train, method="rf")
modelFitRf2

pred <- predict(modelFitRf2, test)
table(pred, test$classe)

pred2 <- predict(modelFitRf2, finalTesting)
pred2

answers <- as.vector(pred2)

pml_write_files = function(x){
  n = length(x)
  for(i in 1:n){
    filename = paste0("problem_id_",i,".txt")
    write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)
  }
}
pml_write_files(answers)
